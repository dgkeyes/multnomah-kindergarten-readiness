---
title: "Multnomah County Schools Kindergarten Readiness"
author: "David Keyes"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)

library(tidyverse)
library(here)
library(ggiraph)
library(tmap)
library(sf)
library(leaflet)
library(scales)
library(tinter)

# Colors

tfff_dark_green <- "#265142"
tfff_light_green <- "#B5CC8E"
tfff_orange <- "#e65100"
tfff_yellow <- "#FBC02D"
tfff_blue <- "#283593"
tfff_red <- "#B71C1C"
tfff_brown <- "#51261C"
tfff_dark_gray <- "#545454"
tfff_medium_gray <- "#a8a8a8"
tfff_light_gray <- "#eeeeee"



multco_schools <- read_csv(here::here("data-clean", "multco-schools.csv")) %>% 
     st_as_sf(coords = c("lon", "lat"),
              crs = 4326)

multco_shapefile <- st_read(here::here("data-clean", "multco-shapefile.shp"))
poverty_shapefile <- st_read(here::here("data-clean", "poverty-shapefile.shp"))

```

# Static



## Map

```{r include = F}

kreadiness_base_plot <- function () {
     ggplot() +
          # geom_sf(data = multco_shapefile) +
          geom_sf(data = poverty_shapefile,
                  color = "#eeeeee",
                  alpha = 0.5) +
          coord_sf(datum = NA) +
          theme_void() +
          # scale_color_viridis_c(option = "B",
          #                       direction = -1) +
          scale_color_gradientn(colours = tinter(tfff_dark_green,
                                                 direction = "both")) +
          labs(color = "") +
          theme(legend.position = "bottom")
}
```


### Approaches

```{r}

approaches <- multco_schools %>% 
     select(approaches_total) %>% 
     mutate(quartile = ntile(approaches_total, 4)) 

kreadiness_base_plot() +
     geom_sf(data = filter(approaches, quartile != 1),
             color = tfff_light_green,
             alpha = .5) +
     geom_sf(data = filter(approaches, quartile == 1),
             color = tfff_dark_green,
             size = 3,
             alpha = .95) +
     coord_sf(datum = NA) 

```

### Math

```{r}

math <- multco_schools %>% 
     select(math_number) %>% 
     mutate(quartile = ntile(math_number, 4)) 

kreadiness_base_plot() +
     geom_sf(data = filter(math, quartile != 1),
             color = tfff_light_green,
             alpha = .5) +
     geom_sf(data = filter(math, quartile == 1),
             color = tfff_dark_green,
             size = 3,
             alpha = .95) +
     coord_sf(datum = NA) 



```


### Literacy
```{r}

kreadiness_base_plot() +
     geom_sf(data = multco_schools,
             aes(color = literacy_letter_sound),
             size = 2.5) +
     coord_sf(datum = NA)
```

## Heatmaps

```{r}
temp <- as.tibble(multco_schools)

kreadiness_base_plot() +
     geom_sf(data = multco_schools,
             aes(color = literacy_letter_sound),
             size = 2.5) +
     geom_bin2d() +
     coord_sf(datum = NA)
```



# Interactive

```{r}

temp <- multco_schools %>% 
     select(school, everything())

tmap_mode("view")

tm_shape(poverty_shapefile) +
     tm_polygons(col = "estimate",
                 palette = "Blues",
                 popup.vars = c("Poverty Rate" = "estimate"),
                 alpha = 0.3) +
     tm_shape(temp) +
     tm_dots(n = 5,
             popup.vars = c("Math" = "math_number"),
             palette = "-inferno",
             col = "literacy_letter_sound") +
     tm_layout(title = "Test")
```




